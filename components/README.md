# TASK 13.4 â€” Map â†” Sidebar Real Sync

## ğŸ¯ Ğ¦ĞµĞ»ÑŒ
Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ñ€Ñ‚Ñ‹, ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ¾Ğ², Ñ‚Ğ¾Ñ‡ĞµĞº Ğ¸ sidebar ĞºĞ°Ğº ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ UX.

## âœ… Ğ§Ñ‚Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾

### 1. Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ñ€Ğ°Ğ²Ğ´Ñ‹: `house.id`
- Ğ’ÑĞµ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ `houseId` = `house.id`
- Clusters API Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `houseId` Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ñ‚Ğ¾Ñ‡ĞºĞ¸
- Sidebar Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚ÑÑ Ğ¿Ğ¾ `visibleHouseIds` Ñ ĞºĞ°Ñ€Ñ‚Ñ‹

### 2. ĞšĞ»Ğ¸Ğº Ğ¿Ğ¾ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ñƒ â†’ Zoom In
```ts
onClusterClick â†’ flyTo(center, zoom + 2)
```

### 3. ĞšĞ»Ğ¸Ğº Ğ¿Ğ¾ Ñ‚Ğ¾Ñ‡ĞºĞµ â†’ Select + Zoom
```ts
onPointClick â†’ setSelectedId(houseId) + flyTo if zoom < 16
```

### 4. Hover ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
- Hover Ğ½Ğ° Ñ‚Ğ¾Ñ‡ĞºĞµ â†’ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° Ğ² sidebar
- Hover Ğ² sidebar â†’ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğµ

### 5. Sidebar Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹
```ts
visibleListings = allHouses.filter(h => visibleHouseIds.includes(h.id))
```

## ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹

| Ğ¤Ğ°Ğ¹Ğ» | Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ |
|------|-----------|
| `types/map.ts` | +houseId Ğ² ClusterProperties, +VisibleFeaturesEvent |
| `lib/clustering.ts` | +houseId Ğ² features, +extractVisibleHouseIds() |
| `components/map/MapContainer.tsx` | +onVisibleHouseIdsChange callback |
| `components/map/ClusterLayer.tsx` | +hover/select highlighting |
| `components/HomeClient.tsx` | +visibleHouseIds state, filtering |
| `components/sidebar/ListingSidebar.tsx` | ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° |

## ğŸš€ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

```bash
# Ğ’ ĞºĞ¾Ñ€Ğ½Ğµ solar-nextjs-template
chmod +x task13.4-fix/INSTALL.sh
./task13.4-fix/INSTALL.sh

# Build
pnpm build

# Test
pnpm dev
```

## ğŸ§ª ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°

| Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ | ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ |
|----------|----------|
| ĞšĞ»Ğ¸Ğº Ğ¿Ğ¾ Ğ·ĞµĞ»Ñ‘Ğ½Ğ¾Ğ¼Ñƒ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ñƒ | Zoom in |
| ĞšĞ»Ğ¸Ğº Ğ¿Ğ¾ Ñ†Ğ²ĞµÑ‚Ğ½Ğ¾Ğ¹ Ñ‚Ğ¾Ñ‡ĞºĞµ | Select + zoom to 16+ |
| Hover Ğ½Ğ° Ñ‚Ğ¾Ñ‡ĞºĞµ | ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ² sidebar |
| Hover Ğ² sidebar | ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğµ |
| Pan/zoom ĞºĞ°Ñ€Ñ‚Ñ‹ | Sidebar Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ |
| Sidebar Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸ Ñ‚Ğ¾Ñ‡ĞºĞ°Ñ… | âŒ ĞĞ• Ğ”ĞĞ›Ğ–ĞĞ Ğ‘Ğ«Ğ¢Ğ¬ |

## ğŸ“Š UX Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   MAP                              SIDEBAR                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  ğŸŸ¢ cluster (5)     â”‚ â”€â”€â”€â”€â”€â”€> â”‚ [loading...]     â”‚     â”‚
â”‚   â”‚  ğŸ”µ point           â”‚         â”‚                  â”‚     â”‚
â”‚   â”‚  ğŸŸ  point           â”‚ <â”€â”€â”€â”€â”€â”€ â”‚ [listing card]   â”‚     â”‚
â”‚   â”‚  ğŸ”´ point           â”‚ hover   â”‚ [listing card]   â”‚     â”‚
â”‚   â”‚                     â”‚         â”‚ [listing card]   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚   visibleHouseIds = [id1, id2, id3]                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš ï¸ Ğ’Ğ°Ğ¶Ğ½Ğ¾

- Sidebar Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ `visibleListings` = Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº
- ĞŸÑ€Ğ¸ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¼ `visibleHouseIds` â†’ sidebar Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ "No listings"
- Ğ­Ñ‚Ğ¾ ĞĞĞ ĞœĞĞ›Ğ¬ĞĞ ĞµÑĞ»Ğ¸ zoom Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¸ Ğ²ÑĞµ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ğ°Ñ…
- ĞŸÑ€Ğ¸ zoom 16+ ĞºĞ»Ğ°ÑÑ‚ĞµÑ€Ñ‹ Ñ€Ğ°ÑĞ¿Ğ°Ğ´Ğ°ÑÑ‚ÑÑ Ğ½Ğ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ â†’ sidebar Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ
