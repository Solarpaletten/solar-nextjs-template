**C=>D**

–ü–æ–¥–∫–ª—é—á—ë–Ω –∫ GitHub —á–µ—Ä–µ–∑ project_knowledge_search.
–û–±–Ω–∞—Ä—É–∂–µ–Ω —Ñ–∞–π–ª: **gitkeep9.md** ‚Äî TASK 7: UX / MAP BEHAVIOR AUDIT

---

## C=>D ‚Äî gitreport9.md

### 1. –ß—Ç–æ —ç—Ç–æ –∑–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–§–∞–π–ª** | `app/page.tsx` |
| **–†–æ–ª—å** | Map-only page (–≥–ª–∞–≤–Ω–∞—è) |
| **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç** | `<MapContainer />` |
| **–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ?** | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ ‚Äî –Ω–µ—Ç sidebar —Å listings |

---

### 2. –ù–∞–π–¥–µ–Ω–Ω—ã–µ UX-–ø—Ä–æ–±–ª–µ–º—ã

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –§–∞–π–ª |
|---|----------|---------|------|
| 1 | ‚ùå **–ö–ª–∞—Å—Ç–µ—Ä—ã "—É–ª–µ—Ç–∞—é—Ç –≤–≤–µ—Ä—Ö"** | `flyTo({ lat, lng }, zoom + 2)` –±–µ–∑ —É—á—ë—Ç–∞ popup offset | `MapContainer.tsx:handleZoomIn` |
| 2 | ‚ùå **–ù–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –∫–ª–∏–∫ —Ç–æ—á–∫–∏** | `onPointClick` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ ClusterLayer, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ MapContainer | `ClusterLayer.tsx` / `MapContainer.tsx` |
| 3 | ‚ö†Ô∏è **–ù–µ—Ç —Å–≤—è–∑–∏ –∫–∞—Ä—Ç–∞ ‚Üî listings** | Sidebar –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, `/listings` ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ | –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| 4 | ‚ö†Ô∏è **–õ–µ–≥–µ–Ω–¥–∞ –Ω–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞** | `<Legend />` ‚Äî —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª, –±–µ–∑ onClick | `components/map/Legend.tsx` |
| 5 | ‚ö†Ô∏è **Popup –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ move** | `handleMapMove` ‚Üí `setSelectedCluster(null)` | `MapContainer.tsx:handleMapMove` |

---

### 3. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ UX-—Ä–µ—à–µ–Ω–∏—è

#### 3.1 –ö–ª–∞—Å—Ç–µ—Ä—ã "—É–ª–µ—Ç–∞—é—Ç" ‚Äî FIX

**–ü—Ä–æ–±–ª–µ–º–∞:** `flyTo` —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç—É –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä, –Ω–æ popup –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É ‚Üí –≤–∏–∑—É–∞–ª—å–Ω–æ –∫–ª–∞—Å—Ç–µ—Ä —É—Ö–æ–¥–∏—Ç –≤–Ω–∏–∑.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// MapContainer.tsx ‚Äî handleZoomIn
// ‚ùå –ë—ã–ª–æ:
flyTo({ lat, lng }, viewport.zoom + 2);

// ‚úÖ –°—Ç–∞–ª–æ:
flyTo({ lat: lat - 0.002, lng }, viewport.zoom + 2); // offset –¥–ª—è popup
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `map.easeTo` —Å `padding`:
```typescript
map.easeTo({
  center: [lng, lat],
  zoom: viewport.zoom + 2,
  padding: { top: 150 }, // –º–µ—Å—Ç–æ –¥–ª—è popup
  duration: 500
});
```

#### 3.2 –ö–ª–∏–∫ –Ω–∞ —Ç–æ—á–∫—É ‚Äî FIX

**–ü—Ä–æ–±–ª–µ–º–∞:** `onPointClick` –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// MapContainer.tsx ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
async function handlePointClick(feature: ClusterFeature) {
  // –ü–æ–∫–∞–∑–∞—Ç—å popup —Å —Ü–µ–Ω–æ–π –∏–ª–∏ redirect –Ω–∞ house detail
  const houseId = feature.properties.listing_id;
  // router.push(`/house/${houseId}`);
}

// –ü–µ—Ä–µ–¥–∞—Ç—å –≤ ClusterLayer
<ClusterLayer
  map={map}
  clusters={clusters}
  onClusterClick={handleClusterClick}
  onPointClick={handlePointClick}  // ‚Üê ADD
/>
```

#### 3.3 –õ–µ–≥–µ–Ω–¥–∞ ‚Äî —Ä–µ—à–µ–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. **–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å** (cosmetic) ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
2. **–°–¥–µ–ª–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–æ–º** (medium) ‚Äî –∫–ª–∏–∫ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –º–∞—Ä–∫–µ—Ä—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –≤–∏–∑—É–∞–ª –Ω–∞ MVP, —Ñ–∏–ª—å—Ç—Ä ‚Äî Phase 2.

#### 3.4 Popup –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ move

**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å auto-close –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å debounce:
```typescript
// ‚ùå –ë—ã–ª–æ:
function handleMapMove() {
  setSelectedCluster(null);
}

// ‚úÖ –°—Ç–∞–ª–æ:
function handleMapMove() {
  // –ù–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å popup –ø—Ä–∏ –Ω–µ–±–æ–ª—å—à–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏
}
```

---

### 4. –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å

| –ü—Ä–æ–±–ª–µ–º–∞ | –£—Ä–æ–≤–µ–Ω—å |
|----------|---------|
| –ö–ª–∞—Å—Ç–µ—Ä—ã —É–ª–µ—Ç–∞—é—Ç | **blocker** |
| –ù–µ—Ç –∫–ª–∏–∫–∞ –Ω–∞ —Ç–æ—á–∫—É | **medium** |
| –õ–µ–≥–µ–Ω–¥–∞ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç | **cosmetic** |
| Popup –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è | **cosmetic** |

---

### 5. –ò—Ç–æ–≥

## ‚ö†Ô∏è UX —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–æ–∫

**–ë–ª–æ–∫–µ—Ä:** –ü–æ–≤–µ–¥–µ–Ω–∏–µ `flyTo` –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä ‚Äî –Ω–µ–∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ.

**–ë—ã—Å—Ç—Ä—ã–π fix (1 —Å—Ç—Ä–æ–∫–∞):**
```
üìç –§–∞–π–ª: components/map/MapContainer.tsx
üìç –§—É–Ω–∫—Ü–∏—è: handleZoomIn
üìç –°—Ç—Ä–æ–∫–∞: flyTo({ lat, lng }, viewport.zoom + 2)
üìç –ó–∞–º–µ–Ω–∏—Ç—å lat –Ω–∞: lat - 0.003
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ —ç–∫—Ä–∞–Ω–∞, –∞ popup –±—É–¥–µ—Ç —Å–≤–µ—Ä—Ö—É.

---

**–ñ–¥—É –∫–æ–º–∞–Ω–¥—É –Ω–∞ fix –∏–ª–∏ task8.** üöÄ